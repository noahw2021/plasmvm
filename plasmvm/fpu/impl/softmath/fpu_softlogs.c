//
//  fpu_softlogs.c
//  plasmvm
//
//  Created by Noah Wooten on 3/4/22.
//

#include "../../fpu.h"
#include <math.h>

x64 fpui_lnx(x64 Value) {
	x64 Return = 0.0;
	for (int i = 1; i <= (4 * (1 / (Value))); i++) {
		Return += (fpud_expi(i + 1, -1.0) * (fpud_expi(i, (Value - 1))) / i);
	}
	return Return;
}

x64 fpui_intlnx[64] = {
	NAN,
	0.0000000000000000,
	0.6931471805599453,
	1.0986122886681098,
	1.3862943611198906,
	1.6094379124341003,
	1.7917594692280550,
	1.9459101490553132,
	2.0794415416798357,
	2.1972245773362196,
	2.3025850929940460,
	2.3978952727983707,
	2.4849066497880004,
	2.5649493574615367,
	2.6390573296152584,
	2.7080502011022100,
	2.7725887222397810,
	2.8332133440562160,
	2.8903717578961645,
	2.9444389791664403,
	2.9957322735539910,
	3.0445224377234230,
	3.0910424533583160,
	3.1354942159291497,
	3.1780538303479458,
	3.2188758248682006,
	3.2580965380214820,
	3.2958368660043290,
	3.3322045101752040,
	3.3672958299864740,
	3.4011973816621555,
	3.4339872044851463,
	3.4657359027997265,
	3.4965075614664802,
	3.5263605246161616,
	3.5553480614894135,
	3.5835189384561100,
	3.6109179126442243,
	3.6375861597263857,
	3.6635616461296463,
	3.6888794541139363,
	3.7135720667043080,
	3.7376696182833684,
	3.7612001156935624,
	3.7841896339182610,
	3.8066624897703196,
	3.8286413964890950,
	3.8501476017100584,
	3.8712010109078910,
	3.8918202981106265,
	3.9120230054281460,
	3.9318256327243257,
	3.9512437185814275,
	3.9702919135521220,
	3.9889840465642745,
	4.0073331852324710,
	4.0253516907351500,
	4.0430512678345500,
	4.0604430105464190,
	4.0775374439057200,
	4.0943445622221000,
	4.1108738641733110,
	4.1271343850450920,
	4.1431347263915330,
};

x64 fpui_log10(x64 Value) {
	x64 O1 = fpui_lnx(1.0 / Value);
	return fpud_abs(O1 / fpui_intlnx[10]);
}
x64 fpui_logx(int Base, x64 Value) {
	x64 O1 = fpui_lnx(1.0 / Value);
	x64 O2 = 1.0;
	if (Base > 63)
		O2 = fpud_abs(fpui_lnx(1.0 / (x64)Base));
	else
		O2 = fpui_intlnx[Base];
	return fpud_abs(O1 / O2);
}

x64 fpui_log(int Base, x64 Value) {
	return fpui_logx(Base, Value);
}
x64 fpui_ln(x64 Value) {
	return fpud_abs(fpui_lnx(1.0 / Value));
}
